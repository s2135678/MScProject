---
title: "01_FeatureSelection_Luise"
author: "Sera Choi"
date: "14/05/2021"
output: html_document
---

## Feature selection of Luise's dataset 

* After quality control, normalisation and integration steps were skipped because the dataset has been normalised and stringent experimental design has minimised batch effect 
* Feature selection aims to select genes that carry most interesting biological information, while eliminating those that introduce noise 

```{r, message=FALSE, warning=FALSE}
# Load library
library(Seurat)
library(ggplot2)
library(dplyr)
library(SingleCellExperiment)
library(scater)
library(here)

# Load data
ecpc <- readRDS(here("data/processed/ecpc_mt_updated.RDS")) 
```

## Visualisation
Here, I visualise the cells using dimensions generated by Luise on all cells. There are two cells (one from group 1 and the other from group 2), that don't cluster well with others, is that cause of concern? 
```{r}
DimPlot(ecpc, reduction='umap')
DimPlot(ecpc, reduction='tsne')
```
## Feature selection 
Feature selection aims to select genes that carry most interesting biological information while eliminating those that introduce noise. Seurat feature selection function learns mean-variance relationship from the data and computes estimated variance of each gene given the mean. Using this estimated variance, variance-stabilising transformation was performed to standardise value of a gene. Then, for each gene, variance of standardised value across all cells was calculated and ranked. Top 2000 genes with highest variance given mean are subsetted.    

```{r, fig.width=10, fig.height=3, warning=FALSE}
# VariableFeatures(ecpc) contains top 2000 highly variable genes 
ecpc <- FindVariableFeatures(ecpc, selection.method = "vst", nfeatures=2000)

# Identify top 10 HVGs
top10 <- head(VariableFeatures(ecpc), 10)
top10

# Plot variable features with and without labels 
plot1 <- VariableFeaturePlot(ecpc)
plot2 <- LabelPoints(plot = plot1, points = top10, repel = TRUE)
plot1 + plot2

# Update Seurat object 
saveRDS(ecpc, "/Users/serachoi/Documents/Edinburgh/MScProject/Project/data/processed/ecpc_mt_updated.RDS")

```






