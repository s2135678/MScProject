---
title: "00_QC_Luise"
author: "Sera Choi"
date: "14/05/2021"
output: html_document
---

## Quality Control of Luise's dataset

* Assesses the quality of Luise's dataset of endothelial cells and pericytes 
in BA4 region of the human brain. 
* Subset of ECs and pericytes in BA4 contains 1,069 cells 
* The data has previously undergone rigorous quality control, but this script aims to 
double check and visualise some QC plots.

```{r, message=FALSE, warning=FALSE}
# Load library
library(Seurat)
library(ggplot2)
library(dplyr)
library(SingleCellExperiment)
library(scater)
library(here)

# Load data
ecpc <- readRDS(here("data/processed/ecpc.RDS")) 
metadata <- ecpc@meta.data #metadata
```

### Proportion of mito transcript 
When Luise QCed her dataset, she QCed spliced and unspliced genes separately using different mito threshold values. Then when the counts for unsplied and spliced were merged together, the mito percentage may have been summed. This script re-evaluates the mito gene percentage and plots the original and new. Re-calculated mito percentage appears to be lower- which is expected?  
```{r}
ecpc[['percent.mt_new']]<- PercentageFeatureSet(ecpc, pattern = "^MT-")
VlnPlot(ecpc, features = c("percent.mt", "percent.mt_new"), ncol = 2)
```

### QC plots 
Here, I plotted violin plots to assess the number of unique genes per cell (nFeature_RNA), total number of molecules detected per cell (nCount_RNA) and proportion of mito genes per cell.

Luise's thresholds:
* UMI count ()

```{r}
VlnPlot(ecpc, features = c("nFeature_RNA","nCount_RNA", "percent.mt_new"), ncol = 3)
max(metadata$nFeature_RNA)
min(metadata$nFeature_RNA)
max(metadata$percent.mt_new)
min(metadata$percent.mt_new)
```

FeatureScater is used to visualise feature-feature relationships. Pearson correlation between two features is displayed at the top.

**Plot 1: number of molecules vs. mito percent** 

* Cells with low number of molecules have high mito % because with smaller number of non-mito transcripts, presence of mito transcript affects the proportion 
* Cells with high number of molecules generally have low mito % because high non-mito trasncript masks away mito transcripts 
* Almost no correlation 

**Plot 2: number of molecules vs. number of unique genes**

* Positive correlation between total number of molecules and genes per cell because if a cell has many molecules, more different genes are expressed 
* As total number of molcules in the cell increases, the number of unique gene increases at decreasing rate because 3 molecules of the same gene is just one gene. 

```{r, fig.width=10, fig.height=4, fig.fullwidth=TRUE}
plot1 <- FeatureScatter(ecpc, feature1 = "nCount_RNA", feature2 = "percent.mt_new")
plot2 <- FeatureScatter(ecpc, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot1 + plot2
```



